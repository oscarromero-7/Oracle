WITH ASIGNACION_PROMEDIO AS (
	SELECT AVG(ASIGNACION) AS "ASIGNACION_PROMEDIO" FROM B_CATEGORIAS_SALARIALES
)
SELECT
    E.NOMBRE,
    E.APELLIDO,
    CS.NOMBRE_CAT AS NOMBRE_CATEGORIA,
    TO_CHAR(CS.ASIGNACION,'999,999,999') as "ASIGNACION",
    A.NOMBRE_AREA AS NOMBRE_AREA
FROM
    B_EMPLEADOS E
INNER JOIN
    B_POSICION_ACTUAL PA ON E.CEDULA = PA.CEDULA
INNER JOIN
    B_CATEGORIAS_SALARIALES CS ON PA.COD_CATEGORIA = CS.COD_CATEGORIA
INNER JOIN
    B_AREAS A ON PA.ID_AREA = A.ID
INNER JOIN ASIGNACION_PROMEDIO AP ON CS.ASIGNACION < AP.ASIGNACION_PROMEDIO
ORDER BY 4 DESC
/
