UPDATE B_ARTICULOS A
SET (COSTO, STOCK_ACTUAL, ULTIMA_COMPRA) = (
    SELECT T.PRECIO_COMPRA,
           T.CANTIDAD,
           T.FECHA
    FROM (
        SELECT 
            DC.PRECIO_COMPRA,
            DC.CANTIDAD,
            C.FECHA AS FECHA,
	    DC.ID_ARTICULO AS ID_ARTICULO,
            ROW_NUMBER() OVER (PARTITION BY DC.ID_ARTICULO ORDER BY C.FECHA DESC) AS RN
        FROM B_COMPRAS C
        INNER JOIN B_DETALLE_COMPRAS DC ON C.ID = DC.ID_COMPRA
    ) T
    WHERE T.RN = 1
    AND A.ID = T.ID_ARTICULO
)
/

