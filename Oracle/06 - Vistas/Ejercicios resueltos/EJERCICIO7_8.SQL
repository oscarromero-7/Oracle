CREATE MATERIALIZED VIEW MV_MOVIMIENTOS_ARTICULOS 
	BUILD IMMEDIATE
	REFRESH START WITH TRUNC(SYSDATE) + 12/24
	NEXT LAST_DAY(SYSDATE) + 23/24
	AS
	SELECT A.ID,
   	A.NOMBRE,
    	COALESCE(SUM(DC.CANTIDAD), 0) AS CANTIDAD_COMPRADA,
    	COALESCE(SUM(DV.CANTIDAD), 0) AS CANTIDAD_VENDIDA,
    	COALESCE(SUM(DC.CANTIDAD), 0) - COALESCE(SUM(DV.CANTIDAD), 0) AS SALDO
	FROM B_ARTICULOS A
	LEFT JOIN B_DETALLE_COMPRAS DC ON A.ID = DC.ID_ARTICULO
	LEFT JOIN B_COMPRAS C ON DC.ID_COMPRA = C.ID AND EXTRACT(MONTH FROM C.FECHA) = EXTRACT(MONTH FROM SYSDATE)
	LEFT JOIN B_DETALLE_VENTAS DV ON A.ID = DV.ID_ARTICULO
	LEFT JOIN B_VENTAS V ON DV.ID_VENTA = V.ID AND EXTRACT(MONTH FROM V.FECHA) = EXTRACT(MONTH FROM SYSDATE)
	GROUP BY A.ID, A.NOMBRE
/
